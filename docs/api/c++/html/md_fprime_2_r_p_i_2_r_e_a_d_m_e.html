<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: Preparations:</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">F´ Flight Software - C/C++ Documentation<span id="projectnumber">&#160;devel</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_fprime_2_r_p_i_2_r_e_a_d_m_e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Preparations:</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md820"></a></p>
<h2><a class="anchor" id="autotoc_md821"></a>
Read up!</h2>
<p>Read the documents in the F' repo as described in the <a class="el" href="md_fprime_2_r_e_a_d_m_e.html">README</a> to get an understanding of the architecture.</p>
<h2><a class="anchor" id="autotoc_md822"></a>
Board Preparation</h2>
<p>This demo was developed on a Raspberry Pi 2 model B. The following directions are how to checkout and run the demo on the Raspberry Pi itself. There are also alternative directions for cross-compiling for the <a class="el" href="namespace_r_p_i.html">RPI</a>. The cross-compile has been tested on Ubuntu as a host. Compiling and running on the <a class="el" href="namespace_r_p_i.html">RPI</a> can be very slow, and the ground system has had some issues running on Raspberry Pi so this guide will walk the user through the setup to cross-compile for the raspberry pi.</p>
<p><b>From the <a class="el" href="namespace_r_p_i.html">RPI</a> configuration menu:</b></p>
<ul>
<li>Enable SPI</li>
<li>Enable UART</li>
</ul>
<p><img src="img/pi_cfg.png" alt="`Raspberry Pi Config`" title="Pi Config" class="inline"/></p>
<p><b>Disable use of the UART for the Linux console:</b></p>
<p><a href="https://www.raspberrypi.com/documentation/computers/configuration.html">Disable UART</a></p>
<p>If the UART port is not set up correctly, there will be a file open error.</p>
<p><b>In order to see results via loopback, connect:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Pin 1   </th><th class="markdownTableHeadNone">Pin 2   </th><th class="markdownTableHeadNone">Signal    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TXD   </td><td class="markdownTableBodyNone">RXD   </td><td class="markdownTableBodyNone">UART    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MISO   </td><td class="markdownTableBodyNone">MOSI   </td><td class="markdownTableBodyNone">SPI    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IO23   </td><td class="markdownTableBodyNone">IO25   </td><td class="markdownTableBodyNone">GPIO    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">IO24   </td><td class="markdownTableBodyNone">IO17   </td><td class="markdownTableBodyNone">GPIO   </td></tr>
</table>
<p><b>If you wish to see the blinking LED demo, connect an LED to GPIO 21 as follows:</b></p>
<p><a href="https://thepihut.com/blogs/raspberry-pi-tutorials/27968772-turning-on-an-led-with-your-raspberry-pis-gpio-pins">Connect an LED</a></p>
<h2><a class="anchor" id="autotoc_md823"></a>
Package Installation</h2>
<p><b>Install the packages necessary to run the demo.</b></p>
<p>Please see INSTALL.md to ensure that the F´ application has been installed and tested with the basic <a class="el" href="namespace_ref.html">Ref</a>. Additionally, the cross-compilers need to be installed. This is done by installing the <code>gcc-arm-linux-gnueabihf</code> and <code>g++-arm-linux-gnueabihf</code> packages on the host system. This is shown on Ubuntu below.</p>
<p><b>Example: Installing Cross-Compilers for Raspberry PI on Ubuntu</b> </p><div class="fragment"><div class="line">sudo apt update &amp;&amp; sudo apt install -y gcc-arm-linux-gnueabihf g++-arm-linux-gnueabihf</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md824"></a>
Build the software</h2>
<p><b>Crosscompiling using CMake:</b></p>
<p>The following commands are described at length in the getting started tutorial. These commands will go to the <a class="el" href="namespace_r_p_i.html">RPI</a> directory and generate a build directory for the <a class="el" href="namespace_r_p_i.html">RPI</a> example. This step generates a CMake Cache, sets the toolchain use to build the code and does an initial scan of the source tree. Since the <a class="el" href="namespace_r_p_i.html">RPI</a> example sets a default F´ toolchain file in its CMakeLists.txt, we do not need to supply one on the command line when generating the build. This only needs to be done once to prepare for the build because CMake will detect changes to its files.</p>
<div class="fragment"><div class="line">cd fprime/RPI</div>
<div class="line">fprime-util generate</div>
</div><!-- fragment --><p>The next set of commands will build the <a class="el" href="namespace_r_p_i.html">RPI</a> code and install it. The installation step is only necessary to make it easier to locate the binary file that the build generates. By default this binary is deep in the build tree and installing it puts the output in the <a class="el" href="namespace_r_p_i.html">RPI</a> folder under the bin subfolder.</p>
<div class="fragment"><div class="line">cd fprime/RPI</div>
<div class="line">fprime-util build</div>
</div><!-- fragment --><p>After the build has completed, the output binary can be found in the <code>build-artifacts/arm-linux-gnueabihf/bin</code> folder.</p>
<p><b>Run the software:</b></p>
<p>The first step to running the software is to run the ground station. This will allow the code running on the Raspberry PI to downlink telemetry that is then displayed in the user's browser. This next step uses port 50000 for the PI to connect to. The user should ensure that this port is not blocked by the system firewall, and is properly forwarded to the network that the raspberry pi is connected to. In the case of a standard home network where the pi and the user's computer are connected to the same network, these typically do not require special setup.</p>
<div class="fragment"><div class="line">cd fprime/RPI</div>
<div class="line">fprime-gds -n --dictionary ./build-artifacts/raspberrypi/dict/RPITopologyDictionary.json</div>
</div><!-- fragment --><p> The ground station should now appear in the user's default browser. Should the user wish to terminate the ground system, return to that terminal and press CTRL-C to shut it down. Please allow it a few moments to finalize and exit. The user may then kill the browser tab displaying the GUI.</p>
<p>In order to run the compiled software, we'll first need to copy it to the <a class="el" href="namespace_r_p_i.html">RPI</a>. This can be done by creating a new terminal, and running the following commands. Note: the ground station should be left running.</p>
<div class="fragment"><div class="line">cd fprime/RPI</div>
<div class="line">scp ./bin/raspberrypi/RPI pi@&lt;pi&#39;s ip&gt;:</div>
<div class="line">ssh pi@&lt;pi&#39;s IP&gt;</div>
</div><!-- fragment --><p>Now the binary is available in home directory of the pi user on the raspberry pi and the user has logged into the pi. The user can then run the following command to launch the embedded application:</p>
<div class="fragment"><div class="line">./RPI -a &lt;ground computer&#39;s IP&gt; -p 50000</div>
</div><!-- fragment --><p>Switching back to the browser's GUI, the user should see channelized telemetry updating by clicking on the "Channels" tab and events by clicking on the "Events" tab.</p>
<p><b>Note:</b> the user should ensure that port 50000 is allowed through the ground computer's firewall.</p>
<p><b>Run some commands:</b></p>
<p>Click on the <code>Commanding</code> tab and drop down the <code>Mnemonic</code> list to see a list of available commands. There are some infrastructure commands, but for the purpose of this demo you can use the Raspberry Pi demo component commands:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Function   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RD_SendString   </td><td class="markdownTableBodyNone">Sends a string on the UART   </td><td class="markdownTableBodyNone">Loops back to an event if wired. See <code>Log Events</code> tab.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">RD_SendSpi   </td><td class="markdownTableBodyNone">Sends a string on the SPI   </td><td class="markdownTableBodyNone">Loops back to an event if wired. See <code>Log Events</code> tab.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RD_SendSpi   </td><td class="markdownTableBodyNone">Sends a string on the SPI   </td><td class="markdownTableBodyNone">Loops back to an event if wired. See <code>Log Events</code> tab.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">RD_SetGpio   </td><td class="markdownTableBodyNone">Sets a GPIO value   </td><td class="markdownTableBodyNone">Loops back to GPIO based on the loopback table.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RD_GetGpio   </td><td class="markdownTableBodyNone">Gets a GPIO value   </td><td class="markdownTableBodyNone">Reads back from GPIO based on the loopback table. The value can be seen in an event in the <code>Log Events</code> tab   </td></tr>
</table>
<p>|RD_SetLed|Turns blinking LED on or off| |RD_SetLedDivider|Sets LED blink rate. Rate is 10Hz/argument|</p>
<p>Look at channelized telemetry and events.</p>
<p>The telemetry in the system can be seen in the <code>Channels</code> tab. The values update once per second. You can see various values updated by the demonstration component.</p>
<p><code>Events</code> are asynchronous messages that indicate events have happened in the system. As you exercise the <code>RD</code>commands, you should see messages appear indicating what is happening in the system.</p>
<p><b>Use parameters</b></p>
<p>Parameters are values that are stored on disk for subsequent executions of the software. The demo has one parameter that is used to set the start up state of the LED to blinking or not blinking. To change the value, invoke the <code>RD_PRMLEDINITSTATE_PRM_SET</code> command with the new value. Then invoke <code>RD_PRMLEDINITSTATE_PRM_SAVE</code> to save the value to the RAM value in <code>Svc/PrmDb</code>. Sending the command <code>PRM_SAVE_FILE</code> will then save the value from RAM to disk. The next time you start the software, you can see the new value in operation.</p>
<p><b>Exit the software</b></p>
<p>CTRL-C in both terminals will stop the software from running.</p>
<p><b>Things to look at</b></p>
<p>The demo consists of a single component along with all the infrastructure components that are part of the repository. The demo component can be found in <code>RPI/RpiDemo</code>. The topology for the demo can be found in <code>RPI/Top</code>. That directory contains the program <code><a class="el" href="_fpp_test_2array_2_main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a></code> as well as the topology XML (<code>RPITopologyAppAi.xml</code>). You can modify and reuse the demo component, or you can create a whole series of interconnected components to do a project. Developers are encouraged to fork the repo to add functionality to the basic demo to enable whatever projects they have in mind.</p>
<p><b>Some tips:</b></p>
<ul>
<li>If you would like to add your own components, read the User's manual on how to add new directories to the build.</li>
<li>If you have defined some component XML, you can generate an empty implementation class by typing <code>fprime-util impl</code>.</li>
<li>You can see the telemetry and events in <code>RPI/logs/&lt;date&gt;/channel.log</code> and <code>RPI/logs/&lt;date&gt;/event.log</code> respectively.</li>
<li>Sometimes you see the error: Could not connect to socket at host addr localhost, port 50000, or address in use This means that the GUI was restarted before the socket was released by Linux. Wait a minute or so and try again. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
