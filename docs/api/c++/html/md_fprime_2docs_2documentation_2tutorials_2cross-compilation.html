<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: F´ Cross-Compilation Setup Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">F´ Flight Software - C/C++ Documentation<span id="projectnumber">&#160;devel</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_fprime_2docs_2documentation_2tutorials_2cross-compilation.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">F´ Cross-Compilation Setup Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md119"></a></p>
<h1><a class="anchor" id="autotoc_md120"></a>
Table of Contents</h1>
<ol type="1">
<li>Cross-Compilation Setup</li>
</ol>
<ol type="1">
<li>Cross-Compilation Tutorial - Compiling for ARM</li>
</ol>
<ol type="1">
<li>F´ Running on ARM Linux Tutorial</li>
</ol>
<ol type="1">
<li>Appendix I: Installing Rancher Desktop and the F´ ARM Container</li>
</ol>
<h1><a class="anchor" id="autotoc_md121"></a>
Cross-Compilation Setup</h1>
<p>In this section, we will learn how to install all the dependencies required for cross-compiling for different architectures. This tutorial will use the Raspberry Pi ARM x64 as an example. In order to fully benefit from this tutorial, the user should acquire a Raspberry Pi.</p>
<h2><a class="anchor" id="autotoc_md122"></a>
Setup Prerequisites</h2>
<p>To run through this tutorial, you must have a computer that meets the following basic requirements.</p>
<ol type="1">
<li>Computer running Windows 10, Mac OS X, or Ubuntu</li>
<li>Administrator access</li>
<li>5GB of free disk space, 8 GB of RAM</li>
<li>Knowledge of the command line for your operating system (Bash, Powershell, Zsh, etc).</li>
</ol>
<h2><a class="anchor" id="autotoc_md123"></a>
Installing Dependencies</h2>
<p>Choose the operating system you are using to install F Prime:</p>
<p>=== "Windows 10/11 WSL" </p><pre class="fragment">**Microsoft Windows 10/11 WSL**

Windows 10 ships with a technology known as WSL. WSL allows users to run Linux virtual machines transparently within the Windows 10 operating system.

**Powershell: Install WSL with Default Ubuntu**
```powershell
wsl --install
```

To start Ubuntu under WSL, search for Ubuntu in the start menu and select the "Ubuntu on Windows" app. All class commands should be run on these Ubuntu terminals.

!!! note
    Full instructions and troubleshooting help is available in the [Microsoft documentation](https://learn.microsoft.com/en-us/windows/wsl/install).

**IMPORTANT:**

Go to the [Ubuntu 20.04 / 22.04 / Generic](#__tabbed_1_3) Linux to finish setting up your WSL environment.
</pre><p>=== "Mac OS X" </p><pre class="fragment">**macOS**

macOS, like Linux, is a Unix system and thus may be used directly for most of this 
tutorial. However, Mac users must install the following utilities 
*and ensure they are available on the command line path*.

1. [Python 3](https://www.python.org/downloads/release/python-3913/)
2. [CMake](https://cmake.org/download/)
3. GCC/CLang typically installed with xcode-select

**Installing GCC/CLang on macOS**
```bash
xcode-select --install
```

Installing Python and running the above command to install gcc/CLang should ensure 
that those tools are on the path.

CMake requires one additional step to ensure it is on the path:

```bash
sudo "/Applications/CMake.app/Contents/bin/cmake-gui" --install
```

In order to cross-compile, a Linux box is essential. You may choose to use a virtual 
machine or may choose to follow the instructions in [Appendix I](#appendix-i-installing-rancher-desktop-and-the-f-arm-container) to 
install a docker container including the necessary tools. 
</pre><p>=== "Ubuntu 20.04 / 22.04 / Generic Linux" </p><pre class="fragment">**Ubuntu 20.04 / 22.04 / Generic Linux**

Ensure that your distribution is up to date.

```sh
sudo apt update
sudo apt install build-essential git g++ gdb cmake python3 python3-venv python3-pip
```
</pre><h2><a class="anchor" id="autotoc_md124"></a>
Installing the Toolchain</h2>
<p>!!! note macOS users must run these commands from within the Docker container described in Appendix I or setup a Linux virtual machine.</p>
<p>Installing the cross-compiler will use the pre-built packages provided by ARM. Follow these instructions to install these tools for the target hardware into the <code>/opt/toolchains</code> directory.</p>
<div class="fragment"><div class="line">sudo mkdir -p /opt/toolchains</div>
<div class="line">sudo chown $USER /opt/toolchains</div>
<div class="line"># For in-person workshops, and users running on 64-bit ARM</div>
<div class="line">curl -Ls https://developer.arm.com/-/media/Files/downloads/gnu-a/10.2-2020.11/binrel/gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz | tar -JC /opt/toolchains --strip-components=1 -x</div>
<div class="line"># For users running on 32-bit ARM</div>
<div class="line">curl -Ls https://developer.arm.com/-/media/Files/downloads/gnu-a/10.2-2020.11/binrel/gcc-arm-10.2-2020.11-x86_64-arm-none-linux-gnueabihf.tar.xz | tar -JC /opt/toolchains --strip-components=1 -x</div>
</div><!-- fragment --><p>Next, ensure that the ARM toolchains were installed properly. To test, run the following command: </p><div class="fragment"><div class="line"># For  64-bit ARM hardware</div>
<div class="line">/opt/toolchains/bin/aarch64-none-linux-gnu-gcc -v </div>
<div class="line"># For 32-bit ARM hardware</div>
<div class="line">/opt/toolchains/bin/arm-none-linux-gnueabihf-gcc -v</div>
</div><!-- fragment --><p> Any output other than "file/command not found" is good.</p>
<h1><a class="anchor" id="autotoc_md125"></a>
Cross-Compilation Tutorial - Compiling for ARM</h1>
<p>In this section, we will learn how to cross-compile for different architectures. This tutorial will use the Raspberry Pi ARM x64 as an example. In order to fully benefit from this tutorial, the user should acquire a Raspberry Pi.</p>
<p>The user should also have an understanding of the Raspberry Pi and specifically how to SSH into the Pi and run applications.</p>
<h2><a class="anchor" id="autotoc_md126"></a>
Compiling for ARM - Prerequisites</h2>
<p>Install the dependencies required for compiling for ARM. See the steps in the Setup Prerequisites for more information.</p>
<h2><a class="anchor" id="autotoc_md127"></a>
Compiling for ARM</h2>
<p>Cross-compiling is as easy as building the deployment for a specific platform. For users running on 64-bit arm the platform is called <code>aarch64-linux</code>, and for users on 32-bit arm use <code>arm-hf-linux</code>. This package expects the environment variable <code>ARM_TOOLS_PATH</code> to point to the installation directory of the ARM cross-compilers.</p>
<p>!!! note Users need to generate for each platform they wish to run on.</p>
<p>Here is how to build for the 64-bit Arm Linux platform:</p>
<div class="fragment"><div class="line">export ARM_TOOLS_PATH=/opt/toolchains</div>
<div class="line"> </div>
<div class="line">#You can check to make sure the environment variable is set by running:</div>
<div class="line">echo $ARM_TOOLS_PATH</div>
<div class="line"> </div>
<div class="line">#This should return the path /opt/toolchains</div>
<div class="line"> </div>
<div class="line"># For in-person workshops and ARM 64-bit hardware</div>
<div class="line"># In: Deployment Folder</div>
<div class="line">fprime-util generate aarch64-linux</div>
<div class="line">fprime-util build aarch64-linux</div>
<div class="line"> </div>
<div class="line"># For ARM 32-bit hardware</div>
<div class="line"># In: Deployment Folder</div>
<div class="line">fprime-util generate arm-hf-linux</div>
<div class="line">fprime-util build arm-hf-linux</div>
</div><!-- fragment --><p> !!! note macOS users must run these commands from within the Docker container described in Appendix I.</p>
<h1><a class="anchor" id="autotoc_md128"></a>
F´ Running on ARM Linux Tutorial</h1>
<p>For this tutorial, the assumption is that the ARM Linux machine is available on the network, is running SSH, and the username, password, device address, and host address are known. Without this configuration, users should skip to the next section of the tutorial.</p>
<p>First, in a terminal upload the software to hardware platform. This is done with:</p>
<div class="fragment"><div class="line"># For ARM 64-bit hardware</div>
<div class="line"># In: Deployment Folder</div>
<div class="line">scp -r build-artifacts/aarch64-linux/&lt;name-of-deployment&gt; &lt;username&gt;@&lt;device-address&gt;:deployment</div>
<div class="line"> </div>
<div class="line"># For ARM 32-bit hardware</div>
<div class="line"># In: Deployment Folder</div>
<div class="line">scp -r build-artifacts/arm-hf-linux/&lt;name-of-deployment&gt; &lt;username&gt;@&lt;device-address&gt;:deployment</div>
</div><!-- fragment --><p> !!! note Users must fill in the username and device address above.</p>
<p>Next run the F´ GDS without launching the native compilation (<code>-n</code>) and with the dictionary from the build above (<code>--dictionary ./build-artifacts/&lt;platform name&gt;/&lt;name-of-deployment&gt;/dict/&lt;.xml document&gt;</code>).</p>
<div class="fragment"><div class="line"># For in-person workshops and ARM 64-bit hardware</div>
<div class="line"># In: Deployment Folder</div>
<div class="line">fprime-gds -n --dictionary build-artifacts/aarch64-linux/&lt;name-of-deployment&gt;/dict/&lt;App Dictionary&gt;.xml --ip-client --ip-address &lt;device-address&gt;</div>
<div class="line"> </div>
<div class="line"># For ARM 32-bit hardware</div>
<div class="line"># In: Deployment Folder</div>
<div class="line">fprime-gds -n --dictionary build-artifacts/aarch64-linux/&lt;name-of-deployment&gt;/dict/&lt;App Dictionary&gt;.xml --ip-client --ip-address &lt;device-address&gt;</div>
</div><!-- fragment --><p> !!! note This depends on a flight software deployment that uses TcpServer as the communications driver implementation.</p>
<p>In another terminal SSH into the device and run the uploaded software: </p><div class="fragment"><div class="line">ssh &lt;username&gt;@&lt;device-address&gt;</div>
<div class="line">sudo deployment/bin/&lt;name-of-deployment&gt; -a 0.0.0.0 -p 50000</div>
</div><!-- fragment --><p> !!! note User should fill in the username and device address above and ensure the correct executable is supplied.</p>
<p>!!! note If the device does not connect, ensure that the firewall port 50000 is open on the flight computer.</p>
<h2><a class="anchor" id="autotoc_md129"></a>
Troubleshooting</h2>
<p>If you are getting errors for missing Libc.c files, make sure when you generate that the logs show that it is using the <code>/opt/toolchains</code> path and not <code>/bin</code>. You can additionally verify that the correct toolchain is being used by watching the logs scroll by when you initially <code>fprime-util generate &lt;toolchain&gt;</code>.</p>
<h1><a class="anchor" id="autotoc_md130"></a>
Appendix I: Installing Rancher Desktop and the F´ ARM Container</h1>
<p>Some users may with to run cross-compilers within docker to minimize the impact of those tools on their systems. Macintosh users will be required to use docker as the ARM/Linux cross-compilers are not available natively for macOS and simple virtualization of a Linux box is no longer practical since the introduction of M1 and M2 hardware.</p>
<h2><a class="anchor" id="autotoc_md131"></a>
Rancher Desktop Setup</h2>
<p>Rancher Desktop is an alternative to Docker Desktop that allows users to run docker containers directly on their desktop computer. It does not require a license for use like Docker Desktop does and also supports both intel and ARM based Macintosh computers.</p>
<p>!!! note Non-Macintosh users are advised to run without the below Docker container</p>
<p>To install <a href="https://rancherdesktop.io/">Rancher Desktop</a>, follow the instructions for your operating system. When presented with a "Welcome to Rancher Desktop" dialog, choose the following settings:</p><ol type="1">
<li>Disable Kubernetes</li>
<li>Select <code>dockerd</code></li>
<li>Configure PATH Automatic</li>
</ol>
<p><img src="../../img/rancher-config.png" alt="Rancher Config" class="inline"/></p>
<p>Ensure that Rancher Desktop is running and that the VM it uses has been started. You can confirm this by ensuring no pop-ups nor progress bars are visible in Rancher Desktop's main window as shown below.</p>
<p><img src="../../img/rancher-running.png" alt="Rancher Main Window" class="inline"/></p>
<p>Once this is done, users can install the container by running the following command in their host terminal. It should complete without errors.</p>
<div class="fragment"><div class="line">docker pull nasafprime/fprime-arm:latest</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md132"></a>
Running The Container</h2>
<p>In order to run the commands provided by the docker container (i.e. the cross-compilers), users must start the container and attach to a terminal inside. This should be done <b>after</b> the user has created a project to work within.</p>
<p>To run this container, users may wish to download <a href="https://github.com/fprime-community/fprime-workshop-led-blinker/blob/main/bin/macos-docker">this script</a> to a <code>bin</code> directory in the root of their project. This will start the docker container with appropriate settings.</p>
<p>Alternatively, the user may run the following command to start the terminal </p><div class="fragment"><div class="line">docker run --platform=linux/amd64 --net host -e USER=$USER -u &quot;`id -u`:`id -g`&quot; -v &quot;/path/to/project:/project&quot; -it nasafprime/fprime-arm:latest</div>
</div><!-- fragment --><p>!!! note Anytime Macintosh users run cross-compilation commands, they <b>must</b> do so in a terminal inside the docker container. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
