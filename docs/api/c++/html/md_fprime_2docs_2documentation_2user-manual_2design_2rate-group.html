<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: Rate Groups and Timeliness</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">F´ Flight Software - C/C++ Documentation<span id="projectnumber">&#160;devel</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_fprime_2docs_2documentation_2user-manual_2design_2rate-group.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Rate Groups and Timeliness</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md205"></a></p>
<p>Often embedded software must perform actions at a fixed rate. In a given system there are usually collections of actions that must run at similar rates. For example, control algorithms may run at 10Hz while telemetry collection may run at 1Hz and background tasks may be updated at 0.1Hz. F´ provides a mechanism to trigger time-based actions called "rate
groups". The <code>ActiveRateGroup</code> component contains multiple output <code>Sched</code> ports that it sends a message to at a repeated rate. Thus, components having an input <code>Sched</code> port can run a repeated action at this rate. Rate groups are driven by a central rate group driver and achieve their rates by dividing the incoming signal from the rate group driver.</p>
<p><img src="../../../img/rate_group.png" alt="Rate Groups" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md206"></a>
Rate Group Driver</h1>
<p>The <code>RateGroupDriver</code> component is the source of the "clock" or tick for the various rate groups. It is usually driven off a system timing interrupt or some other reliable clock source, and it performs the clock divider functionality to produces a series of slower repeating tick signals that are sent to the rate groups attached to it.</p>
<h2><a class="anchor" id="autotoc_md207"></a>
System Clock Sources</h2>
<p>A system clock source needs to be supplied to the rate group driver. This clock source must run at some common multiple of the rates required by the various rate groups. This signal drives the <code>CycleIn</code> port of the rate group driver, and is divided into sub signals sent to the rate groups. Most projects implement a clock component that translates between the system clock and the port call to rate group driver's <code>CycleIn</code> port.</p>
<p>The reference application calls the <code>CycleIn</code> port followed by a sleep for the system clock time within a while loop to simulate a system-driven clock.</p>
<h1><a class="anchor" id="autotoc_md208"></a>
Passive and Active Rate Groups</h1>
<p>The passive and active rate groups receive the input source signal or "tick" at the divided rate as provided from the rate group driver these components are attached to. These components then call each of those components at the subdivided rate. For example, if the rate group driver is being called at 1000Hz it will provide a repeated divide this signal into a set of slower rates (e.g. 100Hz, 10Hz, and 1Hz) and call a rate group at this rate.</p>
<p>Passive rate groups and the rate group driver are passive components. Thus, all work done by the rate group driver, the passive rate groups, and any synchronous ports triggered on components attached to the rate group will be performed in the context of the caller of the rate group driver. This has the advantage of ensuring synchronous and high-priority execution, but care must be taken to ensure that this work quick and critical because it will delay other rate groups from executing.</p>
<p>Active rate groups run on a thread and thus there is some jitter between the system driver and the execution of the rate group. However, multiple active rate groups can start up in unison. However, there is no added concern about the work blocking other rate group executions.</p>
<p>Should the synchronous work done by a rate group take longer than the rate group's cycle time to complete, the rate group will be unable to run the next cycle. This is known as a rate group slip and will produce a WARNING_HI event. Frequent slips indicate that the system is failing to keep up with the repetitive work and the cycle time may need to be increased or child components need to be moved to slower rate groups.</p>
<h2><a class="anchor" id="autotoc_md209"></a>
Active Rate Groups, Ordering, and Priority</h2>
<p>Active rate groups are dependent on thread priority. Typically, rate groups are the highest priority components in the system. This is because they are fairly low impact but start components that are of high priority and thus should be assigned a thread priority higher than that of its children. Faster rate groups tend to be the highest priority of the rate groups.</p>
<p>The active rate group sends messages in order to each of the attached components. Thus, higher priority children tend to be attached to lower index <code>Sched</code> ports than lower priority children.</p>
<h2><a class="anchor" id="autotoc_md210"></a>
Passive and Active Components</h2>
<p>Passive components will run synchronously on the rate group. This has the advantage that if too many things are done on one clock cycle the rate group will slip. However, each child will run in sequence. Active components will receive the message from the active rate group but will not start until their thread becomes active. This allows children to run without blocking each other, however; it becomes harder to detect when more work is scheduled in a cycle than can be completed during the cycle because all work runs concurrently and competes for time across multiple threads.</p>
<h1><a class="anchor" id="autotoc_md211"></a>
Rate Group Example: <code>Ref</code></h1>
<p>The <code><a class="el" href="namespace_ref.html">Ref</a></code> application uses rate groups to drive several system components as well as the demonstration SignalGen components. In the <code><a class="el" href="namespace_ref.html">Ref</a></code> application, the <code>blockDrv</code> component is used to drive the rate group driver. That drives active rate groups that then drive the components.</p>
<p>The topology connections for rate groups can be seen here: <a href="https://github.com/nasa/fprime/blob/ddcb2ec138645da34cd4c67f250b67ee8bc67b26/Ref/Top/topology.fpp#L97-L124">Rate Group Topology</a></p>
<p>A sample schedule handler can be found here: <a href="https://github.com/nasa/fprime/blob/ddcb2ec138645da34cd4c67f250b67ee8bc67b26/Ref/SignalGen/SignalGen.cpp#L98-L140">Sample Schedule Handler</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
